{"openapi":"3.1.0","info":{"title":"Expense Classification API","description":"\n    ## Microservi√ßo para Classifica√ß√£o de Despesas\n    \n    Este microservi√ßo utiliza o m√≥dulo `spend_classification` para classificar transa√ß√µes financeiras\n    usando m√∫ltiplos engines de classifica√ß√£o com fallback inteligente.\n    \n    ### üöÄ Funcionalidades\n    \n    - **Normaliza√ß√£o Textual**: Sempre ativa (lowercase, remo√ß√£o de acentos, etc.)\n    - **Regras Determin√≠sticas**: Controlada por `ENABLE_DETERMINISTIC_RULES` (padr√£o: `false`)\n    - **Similaridade TF-IDF**: Controlada por `ENABLE_TFIDF_SIMILARITY` (padr√£o: `false`)\n    - **Model Adapter**: Sempre ativo (RandomForest + TF-IDF)\n    - **Fallback IA**: Controlado por `ENABLE_FALLBACK_AI` (padr√£o: `true`)\n    - **Tipo de Modelo**: Controlado por `USE_PIPELINE_MODEL` (padr√£o: `true`)\n    \n    ### üîß Configura√ß√£o\n    \n    Configure as vari√°veis de ambiente no arquivo `.env`:\n    \n    ```env\n    # Feature Flags\n    ENABLE_DETERMINISTIC_RULES=false\n    ENABLE_TFIDF_SIMILARITY=false\n    ENABLE_FALLBACK_AI=true\n    USE_PIPELINE_MODEL=true\n    \n    # Thresholds\n    SIMILARITY_THRESHOLD=0.70\n    MODEL_THRESHOLD=0.70\n    \n    # API Keys para Fallback IA (opcional)\n    OPENAI_API_KEY=your_key_here\n    ANTHROPIC_API_KEY=your_key_here\n    SERPAPI_API_KEY=your_key_here\n    ```\n    \n    ### üéØ Tipos de Modelo\n    \n    - **Pipeline Model** (`USE_PIPELINE_MODEL=true`): Usa `modelo_natureza_do_gasto.pkl` (padr√£o)\n    - **Separate Components** (`USE_PIPELINE_MODEL=false`): Usa `vectorizer.pkl` + `classifier.pkl`\n    \n    ### üìä Resposta da API\n    \n    O campo `needs_keys` indica se faltam API keys para o fallback IA:\n    - `needs_keys: true` - Fallback IA habilitado mas faltam chaves\n    - `needs_keys: false` - Fallback IA habilitado e chaves dispon√≠veis\n    - `needs_keys: null` - Fallback IA desabilitado\n    \n    ### üéØ M√©todos de Classifica√ß√£o\n    \n    - `rules_engine` - Regras determin√≠sticas\n    - `similarity_engine` - Similaridade TF-IDF\n    - `model_adapter` - Modelo RandomForest\n    - `ai_fallback` - Fallback com IA (OpenAI/Anthropic)\n    - `fallback` - Fallback padr√£o para casos de d√∫vida\n    ","contact":{"name":"Expense Classification API","url":"https://github.com/your-repo/expense-classification"},"license":{"name":"MIT","url":"https://opensource.org/licenses/MIT"},"version":"1.1.0"},"paths":{"/v1/feedback":{"post":{"tags":["Feedback"],"summary":"Registrar feedback de corre√ß√£o","description":"## üìù **Endpoint de Feedback para Corre√ß√µes do Usu√°rio**\n    \n    Este endpoint permite registrar corre√ß√µes do usu√°rio em transa√ß√µes classificadas.\n    Os dados s√£o salvos em arquivos CSV di√°rios para posterior incorpora√ß√£o ao modelo.\n    \n    ### üîÑ **Funcionalidades**\n    \n    - **Suporte a lote**: Aceita item √∫nico ou array de feedbacks\n    - **Persist√™ncia segura**: Append com locks para concorr√™ncia\n    - **Cria√ß√£o autom√°tica**: Arquivo e cabe√ßalho criados automaticamente\n    - **Mapeamento inteligente**: Convers√£o autom√°tica para formato CSV\n    \n    ### üìä **Mapeamento para CSV**\n    \n    Os campos s√£o mapeados para as seguintes colunas (nesta ordem):\n    \n    1. **Aonde Gastou** ‚Üê `description`\n    2. **Natureza do Gasto** ‚Üê `category` (vazio se ausente)\n    3. **Valor Total** ‚Üê `amount * max(parcelas, 1)`\n    4. **Parcelas** ‚Üê `parcelas` (default 1 se ausente)\n    5. **No da Parcela** ‚Üê `numero_parcela` (vazio se ausente)\n    6. **Valor Unit√°rio** ‚Üê `amount`\n    7. **tipo** ‚Üê `source`\n    8. **Comp** ‚Üê `comp`\n    9. **Data** ‚Üê `date`\n    10. **cartao** ‚Üê `card`\n    11. **transactionId** ‚Üê `transactionId`\n    12. **modelVersion** ‚Üê `modelVersion`\n    13. **createdAt** ‚Üê `createdAt` (timestamp atual se ausente)\n    14. **flux** ‚Üê `flux`\n    \n    ### üéØ **Campos Obrigat√≥rios**\n    \n    - `transactionId`: ID √∫nico da transa√ß√£o\n    - `description`: Descri√ß√£o da transa√ß√£o\n    - `amount`: Valor unit√°rio (deve ser > 0)\n    - `date`: Data no formato ISO\n    \n    ### üìÅ **Arquivo de Destino**\n    \n    Os dados s√£o salvos em: `feedbacks/feedback_YYYY-MM-DD.csv`\n    \n    ### üîí **Comportamento**\n    \n    - **Sem deduplica√ß√£o**: TransactionIds repetidos s√£o registrados novamente\n    - **Concorr√™ncia segura**: Locks por arquivo evitam corrup√ß√£o\n    - **Valores padr√£o**: Campos opcionais ausentes viram vazio no CSV\n    - **Formato decimal**: Valores salvos com ponto decimal (padr√£o)\n    \n    ### üö® **C√≥digos de Resposta**\n    \n    - `201`: Feedback salvo com sucesso\n    - `400`: Dados inv√°lidos ou campos obrigat√≥rios ausentes\n    - `422`: Erro de valida√ß√£o nos dados\n    - `500`: Erro interno do servidor","operationId":"create_feedback_v1_feedback_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedbackRequest"}}},"required":true},"responses":{"201":{"description":"Feedback salvo com sucesso","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedbackResponse"},"example":{"saved_rows":3,"file_path":"feedbacks/feedback_2024-01-01.csv","columns":["Aonde Gastou","Natureza do Gasto","Valor Total","Parcelas","No da Parcela","Valor Unit√°rio","tipo","Comp","Data","cartao","transactionId","modelVersion","createdAt","flux"]}}}},"400":{"description":"Dados inv√°lidos","content":{"application/json":{"example":{"detail":"Lista de feedbacks n√£o pode estar vazia"}}}},"422":{"description":"Erro de valida√ß√£o","content":{"application/json":{"example":{"detail":[{"loc":["body","feedback",0,"amount"],"msg":"ensure this value is greater than 0","type":"value_error.number.not_gt"}]}}}},"500":{"description":"Erro interno do servidor","content":{"application/json":{"example":{"detail":"Erro ao salvar feedbacks: [detalhes do erro]"}}}}}}},"/v1/feedback/file-info":{"get":{"tags":["Feedback"],"summary":"Informa√ß√µes sobre arquivo de feedback","description":"## üìÅ **Informa√ß√µes sobre Arquivo de Feedback**\n    \n    Retorna informa√ß√µes detalhadas sobre o arquivo de feedback de uma data espec√≠fica.\n    \n    ### üìä **Informa√ß√µes Retornadas**\n    \n    - **Arquivo**: Nome e caminho do arquivo\n    - **Exist√™ncia**: Se o arquivo existe no sistema\n    - **Tamanho**: Tamanho em bytes (se existe)\n    - **Modifica√ß√£o**: Data da √∫ltima modifica√ß√£o (se existe)\n    - **Cabe√ßalho**: Se tem cabe√ßalho correto (se existe)\n    - **Colunas**: Lista das colunas esperadas\n    \n    ### üéØ **Par√¢metros**\n    \n    - `date`: Data no formato YYYY-MM-DD (opcional, usa hoje se n√£o especificado)\n    \n    ### üìù **Exemplos**\n    \n    - `GET /v1/feedback/file-info` - Informa√ß√µes do arquivo de hoje\n    - `GET /v1/feedback/file-info?date=2024-01-01` - Informa√ß√µes do arquivo de 01/01/2024","operationId":"get_feedback_file_info_v1_feedback_file_info_get","parameters":[{"name":"date","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Data no formato YYYY-MM-DD (opcional, usa hoje se n√£o especificado)","title":"Date"},"description":"Data no formato YYYY-MM-DD (opcional, usa hoje se n√£o especificado)","example":"2024-01-01"}],"responses":{"200":{"description":"Informa√ß√µes do arquivo","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedbackFileInfo"},"example":{"filename":"feedback_2024-01-01.csv","file_path":"feedbacks/feedback_2024-01-01.csv","exists":true,"columns":["Aonde Gastou","Natureza do Gasto","Valor Total"],"size_bytes":2048,"modified":"2024-01-01T12:00:00","has_header":true}}}},"400":{"description":"Data inv√°lida","content":{"application/json":{"example":{"detail":"Data deve estar no formato YYYY-MM-DD"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/feedback/pipeline/status":{"get":{"tags":["Feedback"],"summary":"Status do Pipeline de Ingest√£o","description":"## üîÑ **Status do Pipeline de Ingest√£o de Feedbacks**\n    \n    Retorna informa√ß√µes sobre o estado atual do pipeline de ingest√£o e retreino.\n    \n    ### üìä **Informa√ß√µes Retornadas**\n    \n    - **Arquivos de feedback**: Quantidade e status\n    - **Arquivos processados**: Lista de arquivos j√° processados\n    - **Modelos**: Timestamps e status dos modelos\n    - **Backups**: Informa√ß√µes sobre backups dispon√≠veis\n    - **M√©tricas**: Estat√≠sticas do pipeline\n    \n    ### üéØ **Uso**\n    \n    Use este endpoint para monitorar o estado do sistema antes de executar\n    opera√ß√µes de ingest√£o ou retreino.","operationId":"get_pipeline_status_v1_feedback_pipeline_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/feedback/pipeline/collect":{"post":{"tags":["Feedback"],"summary":"Coletar Feedbacks para Processamento","description":"## üì• **Coleta de Feedbacks para Processamento**\n    \n    Coleta todos os arquivos de feedback n√£o processados e os prepara para\n    integra√ß√£o com o dataset principal.\n    \n    ### üîÑ **Processo**\n    \n    1. **Lista arquivos**: Encontra todos os arquivos `feedback_*.csv`\n    2. **Filtra novos**: Remove arquivos j√° processados\n    3. **Valida estrutura**: Verifica se cada arquivo tem 14 colunas\n    4. **Remove duplicatas**: Elimina duplicatas por transactionId\n    5. **Marca processados**: Atualiza lista de arquivos processados\n    \n    ### üìä **Resposta**\n    \n    - **Arquivos processados**: Lista de arquivos coletados\n    - **Registros coletados**: Total de registros √∫nicos\n    - **Duplicatas removidas**: Estat√≠sticas de limpeza\n    - **Pr√≥ximos passos**: Sugest√µes para continuar o pipeline\n    \n    ### ‚ö†Ô∏è **Importante**\n    \n    - Arquivos s√£o marcados como processados ap√≥s coleta bem-sucedida\n    - Use `/feedback/pipeline/clear-processed` para reprocessar arquivos\n    - Opera√ß√£o √© idempotente (seguro executar m√∫ltiplas vezes)","operationId":"collect_feedbacks_v1_feedback_pipeline_collect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/feedback/pipeline/merge":{"post":{"tags":["Feedback"],"summary":"Mesclar Feedbacks com Dataset Principal","description":"## üîó **Mesclagem de Feedbacks com Dataset Principal**\n    \n    Integra os feedbacks coletados ao dataset principal para preparar\n    dados para retreino dos modelos.\n    \n    ### üîÑ **Processo**\n    \n    1. **Carrega dataset base**: L√™ arquivo principal de treinamento\n    2. **Coleta feedbacks**: Busca feedbacks n√£o processados\n    3. **Valida integra√ß√£o**: Verifica compatibilidade e qualidade\n    4. **Mescla dados**: Concatena feedbacks ao final do dataset\n    5. **Valida resultado**: Confirma estrutura e integridade\n    \n    ### üìä **Valida√ß√µes Executadas**\n    \n    - **Estrutura de colunas**: Compatibilidade entre base e feedbacks\n    - **Duplicatas**: Detec√ß√£o de transactionIds duplicados\n    - **Qualidade**: Valores nulos e negativos em campos cr√≠ticos\n    - **Balanceamento**: An√°lise de distribui√ß√£o de categorias\n    \n    ### üìà **M√©tricas Retornadas**\n    \n    - **Registros base**: Quantidade no dataset original\n    - **Registros feedback**: Quantidade de feedbacks integrados\n    - **Duplicatas encontradas**: TransactionIds j√° existentes\n    - **Problemas de qualidade**: Issues detectados nos dados\n    \n    ### ‚ö†Ô∏è **Importante**\n    \n    - Dataset base deve existir e ser v√°lido\n    - Opera√ß√£o cria backup autom√°tico antes de modificar\n    - Use `/feedback/pipeline/backup/list` para ver backups","operationId":"merge_feedbacks_v1_feedback_pipeline_merge_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/feedback/pipeline/retrain":{"post":{"tags":["Feedback"],"summary":"Retreinar Modelos com Dados Atualizados","description":"## ü§ñ **Retreino de Modelos com Dados Atualizados**\n    \n    Executa o retreino completo dos modelos usando o dataset atualizado\n    com os feedbacks integrados.\n    \n    ### üîÑ **Processo**\n    \n    1. **Verifica modelos**: Obt√©m timestamps dos modelos atuais\n    2. **Executa treinamento**: Chama `treinar_modelo.py` com dataset atualizado\n    3. **Monitora progresso**: Acompanha execu√ß√£o com timeout de 10min\n    4. **Valida resultados**: Verifica se modelos foram atualizados\n    5. **Testa qualidade**: Valida funcionalidade dos novos modelos\n    \n    ### üìä **Modelos Retreinados**\n    \n    - **modelo_natureza_do_gasto.pkl**: Classifica√ß√£o de categorias\n    - **modelo_comp.pkl**: Classifica√ß√£o de compartilhamento\n    - **modelo_parcelas.pkl**: Predi√ß√£o de parcelas\n    \n    ### üîç **Valida√ß√µes de Qualidade**\n    \n    - **Carregamento**: Modelos podem ser carregados corretamente\n    - **M√©todos**: Presen√ßa de m√©todos `predict` e `predict_proba`\n    - **Teste funcional**: Predi√ß√µes com dados de exemplo\n    - **Tamanho**: Verifica√ß√£o de tamanho dos arquivos\n    \n    ### ‚ö†Ô∏è **Importante**\n    \n    - Timeout de 10 minutos para evitar travamentos\n    - Vari√°veis de ambiente s√£o configuradas automaticamente\n    - Logs detalhados s√£o capturados e retornados\n    - Opera√ß√£o pode ser demorada dependendo do tamanho dos dados","operationId":"retrain_models_v1_feedback_pipeline_retrain_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/feedback/pipeline/run-complete":{"post":{"tags":["Feedback"],"summary":"Executar Pipeline Completo","description":"## üöÄ **Pipeline Completo de Ingest√£o e Retreino**\n    \n    Executa todo o pipeline de ingest√£o de feedbacks em uma √∫nica opera√ß√£o:\n    coleta ‚Üí mesclagem ‚Üí escrita ‚Üí retreino.\n    \n    ### üîÑ **Fluxo Completo**\n    \n    1. **Coleta**: Busca feedbacks n√£o processados\n    2. **Mesclagem**: Integra com dataset principal\n    3. **Escrita**: Salva dataset consolidado com backup\n    4. **Retreino**: Executa treinamento dos modelos\n    5. **Valida√ß√£o**: Confirma qualidade dos resultados\n    \n    ### üìä **M√©tricas Detalhadas**\n    \n    - **Feedbacks coletados**: Quantidade de arquivos processados\n    - **Registros integrados**: Total de registros adicionados\n    - **Modelos atualizados**: Lista de modelos retreinados\n    - **Tempo de execu√ß√£o**: Dura√ß√£o de cada etapa\n    - **Qualidade**: Resultados das valida√ß√µes\n    \n    ### ‚ö†Ô∏è **Importante**\n    \n    - **Opera√ß√£o longa**: Pode levar v√°rios minutos para completar\n    - **Backup autom√°tico**: Dataset original √© preservado\n    - **Rollback**: Em caso de erro, sistema pode ser restaurado\n    - **Monitoramento**: Use `/feedback/pipeline/status` para acompanhar\n    \n    ### üéØ **Quando Usar**\n    \n    - **Integra√ß√£o di√°ria**: Processar feedbacks acumulados\n    - **Retreino semanal**: Atualizar modelos regularmente\n    - **Deploy**: Preparar sistema para produ√ß√£o\n    - **Manuten√ß√£o**: Opera√ß√£o de manuten√ß√£o programada","operationId":"run_complete_pipeline_v1_feedback_pipeline_run_complete_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/feedback/pipeline/backup/list":{"get":{"tags":["Feedback"],"summary":"Listar Backups Dispon√≠veis","description":"## üíæ **Lista de Backups Dispon√≠veis**\n    \n    Retorna lista de todos os backups de dataset dispon√≠veis,\n    ordenados por data de cria√ß√£o (mais recentes primeiro).\n    \n    ### üìä **Informa√ß√µes dos Backups**\n    \n    - **Arquivo**: Nome do arquivo de backup\n    - **Data de cria√ß√£o**: Timestamp de quando foi criado\n    - **Tamanho**: Tamanho do arquivo em bytes\n    - **Status**: Se o arquivo ainda existe\n    \n    ### üîß **Opera√ß√µes Dispon√≠veis**\n    \n    - **Restaurar**: Use backup para restaurar dataset\n    - **Limpar**: Remove backups antigos automaticamente\n    - **Validar**: Verifica integridade dos backups","operationId":"list_backups_v1_feedback_pipeline_backup_list_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/feedback/pipeline/clear-processed":{"post":{"tags":["Feedback"],"summary":"Limpar Lista de Arquivos Processados","description":"## üóëÔ∏è **Limpeza de Arquivos Processados**\n    \n    Remove a lista de arquivos processados, permitindo reprocessamento\n    de todos os arquivos de feedback.\n    \n    ### ‚ö†Ô∏è **CUIDADO**\n    \n    Esta opera√ß√£o permite reprocessar arquivos j√° processados, o que pode\n    causar duplica√ß√£o de dados se executado sem cuidado.\n    \n    ### üéØ **Quando Usar**\n    \n    - **Desenvolvimento**: Durante testes e desenvolvimento\n    - **Corre√ß√£o de bugs**: Ap√≥s corre√ß√£o de problemas no processamento\n    - **Manuten√ß√£o**: Para reprocessar dados com nova l√≥gica\n    - **Reset**: Para reiniciar completamente o pipeline\n    \n    ### üîÑ **Pr√≥ximos Passos**\n    \n    Ap√≥s limpar a lista, execute `/feedback/pipeline/collect` para\n    reprocessar todos os arquivos de feedback.","operationId":"clear_processed_files_v1_feedback_pipeline_clear_processed_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/healthz":{"get":{"summary":"Health Check","description":"Endpoint de health check.","operationId":"health_check_healthz_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/status":{"get":{"summary":"Get Status","description":"üìä **Status detalhado dos engines e configura√ß√µes**\n\nRetorna informa√ß√µes detalhadas sobre o status dos engines de classifica√ß√£o,\nfeature flags ativas e configura√ß√µes do sistema.","operationId":"get_status_v1_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/v1/classify-with-config":{"post":{"summary":"Classify Transactions With Config","description":"üéØ **Classifica transa√ß√µes com configura√ß√£o personalizada**\n\nEste endpoint permite configurar thresholds e feature flags para cada requisi√ß√£o.","operationId":"classify_transactions_with_config_v1_classify_with_config_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClassificationWithConfigRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClassificationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/v1/classify":{"post":{"summary":"Classify Transactions","description":"üéØ **Classifica transa√ß√µes financeiras usando m√∫ltiplos engines**\n\nEste endpoint processa uma lista de transa√ß√µes e retorna suas classifica√ß√µes\nusando o pipeline de classifica√ß√£o com fallback inteligente.\n\n### üîÑ Fluxo de Classifica√ß√£o\n\n1. **Normaliza√ß√£o Textual** (sempre ativa)\n2. **Regras Determin√≠sticas** (se habilitado)\n3. **Similaridade TF-IDF** (se habilitado)\n4. **Model Adapter** (RandomForest - sempre ativo)\n5. **Fallback IA** (se habilitado e resultado = \"duvida\")\n6. **Fallback Padr√£o** (se nenhum m√©todo atender threshold)\n\n### üìä Campos de Resposta\n\n- **`needs_keys`**: Indica status das API keys para fallback IA\n- **`method_used`**: M√©todo que classificou a transa√ß√£o\n\n### üö® C√≥digos de Erro\n\n- `400`: Lista de transa√ß√µes vazia\n- `500`: Erro interno na classifica√ß√£o","operationId":"classify_transactions_v1_classify_post","requestBody":{"content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/TransactionRequest"},"type":"array","title":"Transactions"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ClassificationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"summary":"Root","description":"üè† **Endpoint raiz com informa√ß√µes do servi√ßo**\n\nRetorna informa√ß√µes b√°sicas sobre a API, configura√ß√µes ativas e status dos engines.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"ClassificationResponse":{"properties":{"predictions":{"items":{"$ref":"#/components/schemas/PredictionResponse"},"type":"array","title":"Predictions","description":"Lista de predi√ß√µes para cada transa√ß√£o"},"elapsed_ms":{"type":"number","minimum":0.0,"title":"Elapsed Ms","description":"Tempo total de processamento em milissegundos"},"total_transactions":{"type":"integer","minimum":0.0,"title":"Total Transactions","description":"N√∫mero total de transa√ß√µes processadas"}},"additionalProperties":false,"type":"object","required":["predictions","elapsed_ms","total_transactions"],"title":"ClassificationResponse","description":"Schema para resposta de classifica√ß√£o."},"ClassificationWithConfigRequest":{"properties":{"transactions":{"items":{"$ref":"#/components/schemas/TransactionRequest"},"type":"array","title":"Transactions","description":"Lista de transa√ß√µes para classificar"},"config":{"anyOf":[{"$ref":"#/components/schemas/ConfigurationRequest"},{"type":"null"}],"description":"Configura√ß√£o personalizada (opcional)"}},"type":"object","required":["transactions"],"title":"ClassificationWithConfigRequest","description":"Schema para classifica√ß√£o com configura√ß√£o personalizada."},"ConfigurationRequest":{"properties":{"similarity_threshold":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Similarity Threshold","description":"Threshold para Similarity Engine","default":0.7,"example":0.7},"model_threshold":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Model Threshold","description":"Threshold para Model Adapter","default":0.7,"example":0.7},"enable_deterministic_rules":{"type":"boolean","title":"Enable Deterministic Rules","description":"Habilitar regras determin√≠sticas","default":false,"example":false},"enable_tfidf_similarity":{"type":"boolean","title":"Enable Tfidf Similarity","description":"Habilitar similaridade TF-IDF","default":false,"example":false},"enable_fallback_ai":{"type":"boolean","title":"Enable Fallback Ai","description":"Habilitar fallback IA","default":true,"example":true},"use_pipeline_model":{"type":"boolean","title":"Use Pipeline Model","description":"Usar modelo pipeline (modelo_natureza_do_gasto.pkl)","default":true,"example":true}},"type":"object","title":"ConfigurationRequest","description":"Schema para configura√ß√£o de teste."},"FeedbackFileInfo":{"properties":{"filename":{"type":"string","title":"Filename","description":"Nome do arquivo"},"file_path":{"type":"string","title":"File Path","description":"Caminho completo do arquivo"},"exists":{"type":"boolean","title":"Exists","description":"Se o arquivo existe"},"columns":{"items":{"type":"string"},"type":"array","title":"Columns","description":"Colunas do CSV"},"size_bytes":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Size Bytes","description":"Tamanho em bytes (se existe)"},"modified":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Modified","description":"Data de modifica√ß√£o (se existe)"},"has_header":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Has Header","description":"Se tem cabe√ßalho correto (se existe)"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error","description":"Erro ao ler arquivo (se houver)"}},"type":"object","required":["filename","file_path","exists","columns"],"title":"FeedbackFileInfo","description":"Schema para informa√ß√µes sobre arquivo de feedback."},"FeedbackItem":{"properties":{"transactionId":{"type":"string","title":"Transactionid","description":"ID √∫nico da transa√ß√£o (obrigat√≥rio)","example":"tx_123456789"},"description":{"type":"string","title":"Description","description":"Descri√ß√£o da transa√ß√£o - 'Aonde Gastou' (obrigat√≥rio)","example":"Netflix Com"},"amount":{"type":"number","exclusiveMinimum":0.0,"title":"Amount","description":"Valor unit√°rio da transa√ß√£o (obrigat√≥rio)","example":44.9},"date":{"type":"string","title":"Date","description":"Data da transa√ß√£o no formato ISO (obrigat√≥rio)","example":"2024-01-01T00:00:00Z"},"source":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Source","description":"Tipo/fonte da transa√ß√£o (opcional)","example":"cr√©dito"},"card":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Card","description":"Informa√ß√µes do cart√£o (opcional)","example":"Final 8073 - JOAO G B CALICE"},"modelVersion":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Modelversion","description":"Vers√£o do modelo usado na classifica√ß√£o (opcional)","example":"v1.2.0"},"createdAt":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Createdat","description":"Timestamp de cria√ß√£o do feedback (opcional)","example":"2024-01-01T12:00:00Z"},"category":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category","description":"Natureza do Gasto - categoria corrigida (opcional)","example":"Entretenimento"},"flux":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Flux","description":"Entrada/Sa√≠da - fluxo da transa√ß√£o (opcional)","example":"Sa√≠da"},"comp":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Comp","description":"Comp - informa√ß√£o adicional (opcional)","example":""},"parcelas":{"anyOf":[{"type":"integer","minimum":1.0},{"type":"null"}],"title":"Parcelas","description":"N√∫mero total de parcelas (opcional, default 1)","example":12},"numero_parcela":{"anyOf":[{"type":"integer","minimum":1.0},{"type":"null"}],"title":"Numero Parcela","description":"N√∫mero da parcela atual (opcional)","example":4}},"type":"object","required":["transactionId","description","amount","date"],"title":"FeedbackItem","description":"Schema para um item de feedback individual.\n\nRepresenta uma corre√ß√£o do usu√°rio para uma transa√ß√£o classificada."},"FeedbackRequest":{"properties":{"feedback":{"anyOf":[{"$ref":"#/components/schemas/FeedbackItem"},{"items":{"$ref":"#/components/schemas/FeedbackItem"},"type":"array"}],"title":"Feedback","description":"Item √∫nico ou lista de feedbacks para salvar"}},"type":"object","required":["feedback"],"title":"FeedbackRequest","description":"Schema para requisi√ß√£o de feedback.\n\nAceita tanto um item √∫nico quanto uma lista de itens."},"FeedbackResponse":{"properties":{"saved_rows":{"type":"integer","minimum":0.0,"title":"Saved Rows","description":"N√∫mero de linhas salvas no CSV","example":3},"file_path":{"type":"string","title":"File Path","description":"Caminho do arquivo CSV onde os dados foram salvos","example":"feedbacks/feedback_2024-01-01.csv"},"columns":{"items":{"type":"string"},"type":"array","title":"Columns","description":"Lista das colunas do CSV na ordem","example":["Aonde Gastou","Natureza do Gasto","Valor Total"]}},"type":"object","required":["saved_rows","file_path","columns"],"title":"FeedbackResponse","description":"Schema para resposta do endpoint de feedback.\n\nRetorna informa√ß√µes sobre o resultado da opera√ß√£o de salvamento."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"PredictionResponse":{"properties":{"label":{"type":"string","title":"Label","description":"Categoria classificada da transa√ß√£o","example":"Netflix"},"confidence":{"type":"number","maximum":1.0001,"minimum":0.0,"title":"Confidence","description":"Confian√ßa da classifica√ß√£o (0.0 a 1.0)","example":0.95},"method_used":{"type":"string","title":"Method Used","description":"M√©todo usado para classifica√ß√£o","example":"rules_engine"},"elapsed_ms":{"type":"number","minimum":0.0,"title":"Elapsed Ms","description":"Tempo de processamento em milissegundos","example":5.2},"transaction_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Transaction Id","description":"ID da transa√ß√£o processada"},"needs_keys":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Needs Keys","description":"Indica se faltam API keys para fallback IA (true/false/null)"},"raw_prediction":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Raw Prediction","description":"Dados brutos da predi√ß√£o para debugging"}},"additionalProperties":false,"type":"object","required":["label","confidence","method_used","elapsed_ms"],"title":"PredictionResponse","description":"Schema para resposta de predi√ß√£o."},"TransactionRequest":{"properties":{"id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Id","description":"ID √∫nico da transa√ß√£o (opcional)"},"description":{"type":"string","title":"Description","description":"Descri√ß√£o da transa√ß√£o (obrigat√≥rio)","example":"Netflix Com"},"amount":{"type":"number","exclusiveMinimum":0.0,"title":"Amount","description":"Valor da transa√ß√£o em reais (obrigat√≥rio)","example":44.9},"date":{"type":"string","title":"Date","description":"Data da transa√ß√£o no formato ISO (obrigat√≥rio)","example":"2024-01-01"},"card_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Card Number","description":"N√∫mero do cart√£o (opcional)"},"card_holder":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Card Holder","description":"Nome do portador do cart√£o (opcional)"},"origin":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Origin","description":"Origem da transa√ß√£o (opcional)"},"installments":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Installments","description":"N√∫mero total de parcelas (opcional)"},"installment_number":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Installment Number","description":"N√∫mero da parcela atual (opcional)"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata","description":"Metadados adicionais (opcional)"}},"additionalProperties":false,"type":"object","required":["description","amount","date"],"title":"TransactionRequest","description":"Schema para requisi√ß√£o de transa√ß√£o."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}